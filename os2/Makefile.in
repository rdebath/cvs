# Makefile for OS/2.  Generated from Makefile.in when CVS is
# configured for a dist-build.  Configure never gets run on OS/2, so
# we must include the generated Makefile in the distribution.  See the
# `dist-dir' rule.

project: cvs.exe
# .SUFFIXES .c .obj .exe

# path slash
# Maintainers: always leave this set to "/", because `make dist' has
# to work on Unix systems.  See os2/README to find out why we have
# this var.
PS = /

# I don't want to fool around with autoconf right now.  First get it
# working, then make it fancy.
srcdir     = .
top_srcdir = ..
libdir     = ..${PS}lib
cvs_srcdir = ..${PS}src

# Do we need these?
# prefix = /usr/local
# exec_prefix = ${prefix}

# taken straight from the example project
LIB = s:${PS}ibmcpp${PS}lib;s:${PS}toolkt21${PS}os2lib;
CINC = -Is:${PS}ibmcpp${PS}include -Is:${PS}toolkt21${PS}c${PS}os2h
# This says we are building an object file, not a full executable.
OBJ_CFLAGS = -C+
CFLAGS = -W3 -Wpro+rea+tru+use+ -Ti+ -Ss+ -Gd+ -Gm+ -G4 -Q+ -Sm ${CINC}
CFLAGS += -I${srcdir} -I${libdir} -I${cvs_srcdir}
CFLAGS += -DIBM_CPP -DHAVE_CONFIG_H

# TCP/IP stuff
TCPIPLIB = s:${PS}ibmtcpip${PS}lib${PS}tcp32dll.lib	s:${PS}ibmtcpip${PS}lib${PS}so32dll.lib

# I am 99% sure this is irrelevant, but...
# porttcp.obj

# We probably don't need these.
# RPCLIB   = s:${PS}ibmtcpip${PS}lib${PS}rpc32dll.lib
# FTPLIB   = s:${PS}ibmtcpip${PS}lib${PS}ftpapi.lib

CFLAGS 	 += -DTCPIP_IBM -Is:${PS}ibmtcpip${PS}include


# headers specific to OS/2
# tcpip.mak is almost certainly unnecessary, but I include it for now.

# We list OS2_HEADERS so we know what to include when we make dist-dir
# here.
OS2_HEADERS = \
       tcpip.h \
       tcpip.mak \
       config.h \
       options.h \
       pwd.h \
       dirent.h \
       rcmd.h \
       client.h \
       popen.h

# headers we use from the common src dir, ..${PS}src
COMMON_HEADERS = \
       ${cvs_srcdir}${PS}cvs.h \
       ${cvs_srcdir}${PS}rcs.h \
       ${cvs_srcdir}${PS}hash.h \
       ${cvs_srcdir}${PS}myndbm.h \
       ${cvs_srcdir}${PS}patchlevel.h \
       ${cvs_srcdir}${PS}update.h \
       ${cvs_srcdir}${PS}server.h \
       ${cvs_srcdir}${PS}error.h

# sources specific to OS/2
OS2_SOURCES = \
       mkdir.c \
       pwd.c \
       filesubr.c \
       dirent.c \
       run.c \
       stripslash.c \
       startserver.c \
       rcmd.c \
       waitpid.c \
       popen.c \
       strippath.c \
       client.c

# sources we use from the common src dir, ..${PS}src
COMMON_SOURCES = \
       ${cvs_srcdir}${PS}add.c \
       ${cvs_srcdir}${PS}admin.c \
       ${cvs_srcdir}${PS}checkin.c \
       ${cvs_srcdir}${PS}checkout.c \
       ${cvs_srcdir}${PS}classify.c \
       ${cvs_srcdir}${PS}commit.c \
       ${cvs_srcdir}${PS}create_adm.c \
       ${cvs_srcdir}${PS}cvsrc.c \
       ${cvs_srcdir}${PS}diff.c \
       ${cvs_srcdir}${PS}entries.c \
       ${cvs_srcdir}${PS}error.c \
       ${cvs_srcdir}${PS}expand_path.c \
       ${cvs_srcdir}${PS}find_names.c \
       ${cvs_srcdir}${PS}hash.c \
       ${cvs_srcdir}${PS}history.c \
       ${cvs_srcdir}${PS}ignore.c \
       ${cvs_srcdir}${PS}import.c \
       ${cvs_srcdir}${PS}lock.c \
       ${cvs_srcdir}${PS}log.c \
       ${cvs_srcdir}${PS}login.c \
       ${cvs_srcdir}${PS}logmsg.c \
       ${cvs_srcdir}${PS}main.c \
       ${cvs_srcdir}${PS}modules.c \
       ${cvs_srcdir}${PS}myndbm.c \
       ${cvs_srcdir}${PS}no_diff.c \
       ${cvs_srcdir}${PS}parseinfo.c \
       ${cvs_srcdir}${PS}patch.c \
       ${cvs_srcdir}${PS}rcs.c \
       ${cvs_srcdir}${PS}rcscmds.c \
       ${cvs_srcdir}${PS}recurse.c \
       ${cvs_srcdir}${PS}release.c \
       ${cvs_srcdir}${PS}remove.c \
       ${cvs_srcdir}${PS}repos.c \
       ${cvs_srcdir}${PS}root.c \
       ${cvs_srcdir}${PS}rtag.c \
       ${cvs_srcdir}${PS}server.c \
       ${cvs_srcdir}${PS}status.c \
       ${cvs_srcdir}${PS}subr.c \
       ${cvs_srcdir}${PS}tag.c \
       ${cvs_srcdir}${PS}update.c \
       ${cvs_srcdir}${PS}wrapper.c \
       ${cvs_srcdir}${PS}vers_ts.c \
       ${cvs_srcdir}${PS}version.c
# end of $COMMON_SOURCES

# sources from ..${PS}lib
LIB_SOURCES = \
       ${libdir}${PS}getopt.c \
       ${libdir}${PS}getopt1.c \
       ${libdir}${PS}getline.c \
       ${libdir}${PS}getwd.c \
       ${libdir}${PS}save-cwd.c \
       ${libdir}${PS}sighandle.c \
       ${libdir}${PS}yesno.c \
       ${libdir}${PS}xgetwd.c \
       ${libdir}${PS}md5.c \
       ${libdir}${PS}fnmatch.c \
       ${libdir}${PS}regex.c \
       ${libdir}${PS}getdate.c

# object files from OS/2 sources
OS2_OBJECTS = \
       mkdir.obj \
       pwd.obj \
       filesubr.obj \
       dirent.obj \
       run.obj \
       stripslash.obj \
       startserver.obj \
       rcmd.obj \
       waitpid.obj \
       popen.obj \
       strippath.obj \
       client.obj

# object files from ..${PS}src
COMMON_OBJECTS = \
       ${cvs_srcdir}${PS}add.obj \
       ${cvs_srcdir}${PS}admin.obj \
       ${cvs_srcdir}${PS}checkin.obj \
       ${cvs_srcdir}${PS}checkout.obj \
       ${cvs_srcdir}${PS}classify.obj \
       ${cvs_srcdir}${PS}commit.obj \
       ${cvs_srcdir}${PS}create_adm.obj \
       ${cvs_srcdir}${PS}cvsrc.obj \
       ${cvs_srcdir}${PS}diff.obj \
       ${cvs_srcdir}${PS}entries.obj \
       ${cvs_srcdir}${PS}error.obj \
       ${cvs_srcdir}${PS}expand_path.obj \
       ${cvs_srcdir}${PS}find_names.obj \
       ${cvs_srcdir}${PS}hash.obj \
       ${cvs_srcdir}${PS}history.obj \
       ${cvs_srcdir}${PS}ignore.obj \
       ${cvs_srcdir}${PS}import.obj \
       ${cvs_srcdir}${PS}lock.obj \
       ${cvs_srcdir}${PS}log.obj \
       ${cvs_srcdir}${PS}login.obj \
       ${cvs_srcdir}${PS}logmsg.obj \
       ${cvs_srcdir}${PS}main.obj \
       ${cvs_srcdir}${PS}modules.obj \
       ${cvs_srcdir}${PS}myndbm.obj \
       ${cvs_srcdir}${PS}no_diff.obj \
       ${cvs_srcdir}${PS}parseinfo.obj \
       ${cvs_srcdir}${PS}patch.obj \
       ${cvs_srcdir}${PS}rcs.obj \
       ${cvs_srcdir}${PS}rcscmds.obj \
       ${cvs_srcdir}${PS}recurse.obj \
       ${cvs_srcdir}${PS}release.obj \
       ${cvs_srcdir}${PS}remove.obj \
       ${cvs_srcdir}${PS}repos.obj \
       ${cvs_srcdir}${PS}root.obj \
       ${cvs_srcdir}${PS}rtag.obj \
       ${cvs_srcdir}${PS}server.obj \
       ${cvs_srcdir}${PS}status.obj \
       ${cvs_srcdir}${PS}subr.obj \
       ${cvs_srcdir}${PS}tag.obj \
       ${cvs_srcdir}${PS}update.obj \
       ${cvs_srcdir}${PS}wrapper.obj \
       ${cvs_srcdir}${PS}vers_ts.obj \
       ${cvs_srcdir}${PS}version.obj
# end of $COMMON_OBJECTS

# objects from ..${PS}lib
LIB_OBJECTS = \
       ${libdir}${PS}getopt.obj \
       ${libdir}${PS}getopt1.obj \
       ${libdir}${PS}getline.obj \
       ${libdir}${PS}getwd.obj \
       ${libdir}${PS}save-cwd.obj \
       ${libdir}${PS}sighandle.obj \
       ${libdir}${PS}yesno.obj \
       ${libdir}${PS}xgetwd.obj \
       ${libdir}${PS}md5.obj \
       ${libdir}${PS}fnmatch.obj \
       ${libdir}${PS}regex.obj \
       ${libdir}${PS}getdate.obj

SOURCES = ${COMMON_SOURCES} ${LIB_SOURCES} ${OS2_SOURCES}
HEADERS = ${COMMON_HEADERS} ${OS2_HEADERS}
OBJECTS = ${COMMON_OBJECTS} ${LIB_OBJECTS} ${OS2_OBJECTS}

DISTFILES = ${OS2_HEADERS} ${OS2_SOURCES} \
  README ChangeLog Makefile.in .cvsignore test-makefile Makefile

all:

.PHONY: all install uninstall
all install uninstall:

.PHONY: tags TAGS
tags TAGS:

.PHONY: ls
ls:
	@echo ${DISTFILES}

.PHONY: clean distclean realclean mostlyclean
clean distclean realclean mostlyclean:

.PHONY: lint
lint:

.PHONY: dist-dir
dist-dir:
	mkdir ${DISTDIR}
	for i in ${DISTFILES}; do \
	  ln ${srcdir}${PS}$${i} ${DISTDIR}; \
	done

clean:
	rm -f *.obj cvs.exe

%.obj: %.c
	icc ${OBJ_CFLAGS} ${CFLAGS} /Fo$@ $*.c

# There seems to be no ICC option for specifying library locations, so
# we must `set' the path in the compilation environment.  Urgkle. 
cvs.exe: ${OBJECTS}
	echo Creating icc.in...
	echo -Q+ -Ti+ -Fe$@ -B"/batch" > icc.in
	echo ${OS2_OBJECTS}            >> icc.in
	echo ${LIB_OBJECTS}            >> icc.in
	echo ${COMMON_OBJECTS}         >> icc.in
	echo ${TCPIPLIB}               >> icc.in
	echo Creating icc.in... done.
	set LIB=${LIB} & icc @icc.in

# cvs.obj: ${OBJECTS} ${SOURCES} ${HEADERS}
