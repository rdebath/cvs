Thu Sep 25 14:34:22 1997  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* util.c (begin_output, finish_output): If PR_PROGRAM is not
	defined (VMS), just give a fatal error if --paginate specified.

	* Makefile.in (DISTFILES): Add ChangeLog build_diff.com
	Makefile.in.
	* build_diff.com: New file.

Wed Sep 24 10:27:00 1997  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Makefile.in: Also set top_srcdir.  Needed to make today's other
	Makefile.in change work.

	* .cvsignore: New file.

	* Makefile.in (COMPILE): Add -I options for srcdir (perhaps
	unneeded) and change -I option for lib to use top_srcdir (needed
	to avoid mixups with CVS's regex.h vs. the system one).

Sun Sep 21 19:44:42 1997  Jim Kingdon  <kingdon@harvey.cyclic.com>

	* Makefile.in (util.o): Change util.c to $<, needed for srcdir.

Sat Sep 20 12:06:41 1997  Tim Pierce  <twp@twp.tezcat.com>

	New diff library for CVS, based on diffutils-2.7.  See diffutils
	for earlier ChangeLogs.
	* Makefile.in, analyze.c, cmpbuf.c, cmpbuf.h, config.hin,
	context.c, diagmeet.note, diff.c, diff.h, dir.c, ed.c, ifdef.c,
	io.c, normal.c, side.c, stamp-h.in, system.h, util.c, version.c:
	New files.
	(COMPILE): Add -I../lib, so we can get getopt.h.

	* Makefile.in: Removed anything not related to libdiff.a.
	(dist-dir): New target, copied from ../lib/Makefile.in.
	(DISTFILES): New variable.
	(SOURCES): Renamed from `srcs'.
	(OBJECTS): Renamed from `libdiff_o'.
	(Makefile): Changed dependencies to reflect
	new, shallow config directory structure.
	(stamp-h.in, config.h.in, config.h, stamp-h): Removed.
	* stamp-h.in, config.h.in: Removed.

	* system.h: Remove dup2 macro (provided by ../lib/dup2.c).
	Include stdlib.h if STDC_HEADERS is defined (not just
	HAVE_STDLIB_H).

Sat Sep 20 05:32:18 1997  Tim Pierce  <twp@twp.tezcat.com>

	Diff librarification.
	
	* diff.c (diff_run): New function, renamed from `main'.
	Initialize `outfile' based on the value of the new `out' filename
	argument.
	(initialize_main): New function.
	* system.h: Removed initialize_main macro.
	* diffmain.c: New file.
	* Makefile.in (diff): Added diffmain.o.
 	(libdiff): New target.
	(AR, libdiff_o): New variables.  libdiff_o does not include
	xmalloc.o, fnmatch.o, getopt.o, getopt1.o, regex.o or error.o,
	because these functions are already present in CVS.  It will take
	some work to make this more general-purpose.

	Redirect standard output.
	* util.c: Redirect stdout to outfile: change all naked `printf'
 	and `putchar' statements to `fprintf (outfile)' and `putc (...,
 	outfile)' throughout.  This should permit redirecting diff output
 	by changing `outfile' just once in `diff_run'.
	(output_in_progress): New variable.
	(begin_output, finish_output): Use `output_in_progress', rather than
	`outfile', as a semaphore to avoid reentrancy problems.
	(finish_output): Close `outfile' only if paginate_flag is set.
	* diff.c (check_output): New function, was check_stdout.  Take a
	`file' argument, and flush it instead of closing it.
	(diff_run): Change check_stdout to check_output.
	(compare_files): Fflush outfile, not stdout.
	
	Eliminate exit statements.
	* diff.h: Include setjmp.h.
	(diff_abort_buf): New variable.
	(DIFF_ABORT): New macro.
	* diff.c (diff_run): Change all `exit' statements to `return'.
	Set up diff_abort_buf, so we can abort diff without
	terminating (for libdiff.a).
	(try_help): Return int instead of void; do not exit.
	* util.c (fatal): Use DIFF_ABORT instead of exit.
	(pfatal_with_name): Use DIFF_ABORT instead of exit.

	Namespace cleanup (rudimentary).  Strictly speaking, this is not
 	necessary to make diff into a library.  However, namespace
	clashes between diff and CVS must be resolved immediately, since
	CVS is the first application targeted for use with difflib.
	
	* analyze.c, diff.c, diff.h, util.c (diff_error): Renamed from `error'.
	
	* version.c, diff.c, diff.h, cmp.c, diff3.c, sdiff.c
	(diff_version_string): Renamed from version_string.
	* diff.c, util.c, diff.h, diff3.c, error.c (diff_program_name):
	Renamed from program_name.

	* util.c (xmalloc, xrealloc): Removed.
	* Makefile.in (diff_o): Added error.o and xmalloc.o.

